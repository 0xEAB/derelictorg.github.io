<!DOCTYPE HTML>
<html lang="en" >
<head>
    <title>Derelict Documentation -- Using Derelict -- Failure</title>
    <meta name="author" content="Mike Parker">
    <meta name="description" content="Documentation for the DerelictOrg project (https://github.com/DerelictOrg/).">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="../css/reset.css">
    <link rel="stylesheet" type="text/css" href="../css/style.css">
</head>
<body>
    <div id="header" role="banner">
        <h1>Using</h1>
    </div>
    <div class="col-sidebar">
        <div id="navbar" role="navigation">
            <ul class="menu">
            <li class="menu"><a href="../index.html">Home</a></li>
            <li class="menu"><a href="../using.html">Using Derelict</a></li>
            <li class="menu"><a href="../packages.html">Derelict Packages</a></li>
            </ul>
        </div>
    </div>
    <div class="col-main">
        <div class="note" role="complementary">
            <p>Please note that this documentation is under development and is currently incomplete.</p>
        </div>
        <div id="content">
            <h2>Failure to Load</h2>

            <p>Sometimes, a library cannot be loaded. There are a handful of reasons why this may happen. In each case, Derelict will throw an exception. There is a way to prevent exceptions from being thrown.</p>

            <h3>Loader Exceptions</h3>

            <p>When a shared library cannot be loaded, the ader will throw a sublcass of <tt>DerelictException</tt>, which in turn is a subclass of D's <tt>Exception</tt>. More specifically, a <tt>SymbolLoadException</tt> is thrown when a function is not found in the shared library. A <tt>SharedLibLoadException</tt> is found when a shared library is not present on the system path, or fails to load into memory for some other reason.</p>

            <p>The loader will attempt to load every library name that it is given. It will only throw a <tt>SharedLibLoadException</tt> when the last library name fails to load. When any given function fails to load, loading will be aborted and a <tt>SymbolLoadException</tt> thrown immediately. To catch and manipulate any of these excptions, import <tt>derelict.util.exception</tt></p>

            <p>In some cases, it may be desirable that the loader continue and no exception be thrown when a symbol is missing. For example, when a Derelict package has been updated to support the latest version of a C library, but the user wants to continue supporting the older version of the C library. One option is to use <tt>SharedLibVersion</tt> with any loaded that supports it. See <a href="load.html">Loading a Shared Library</a> for more information. Where <tt>SharedLibVersion</tt> is not supported, there are two possibilites. The recommended approach is to continue using the version of the Derelict package that supports the minimally required version of the C library. The other option is to use a library a feature called <em>selective symbol loading</em>.</p>

            <h3>Selective Symbol Loading</h3>

            <p>Selective symbol loading is a means of telling a Derelict loader that it is okay to continue loading a library when a specific symbol is missing. Each loader has a <tt>missingSymbolCallback</tt> property which can be set to either a D delegate or function pointer. The signature in both cases is the same. An example usage follows.</p>

            <pre><code>
            // This is needed for the return type enum.
            import derelict.util.exception;

            import derelict.sdl2.sdl;

            ShouldThrow myMissingSymCB( string symbolName )
            {
                if( symbolName == "SDL2_SomeFuncIDon'tNeed" )
                {
                    return ShouldThrow.No;
                }
                else
                {
                    return ShouldThrow.Yes;
                }
            }

            void main()
            {
                // Set the callback *before* calling load
                DerelictSDL2.missimgSymbolCallback = &myMissingSymCB;
                DerelictSDL2.load();
            }
            </code></pre>

            <p>The use of the <tt>ShouldThrow</tt> enum makes it easier to remember which value to return when implementing the callback. A simple <tt>true</tt> or <tt>false</tt> can sometimes be confusing: does <tt>true</tt> mean throw or don't throw? Because of the enum, <tt>derelict.util.exception</tt> must be imported, but there is no confusion.</p>

            <p>The important point here is that the callback must be set <strong>before</strong> calling the <tt>load</tt> method. Otherwise, the loader will have no callback to call. Also note that this is a very basic example. There is usually more than one function that must be ignored. When using a <tt>MissingSymbolCallback</tt>, it is imperative to check the change log for each new version of the C library to understand what has changed between versions so that a complete set of symbol names can be covered. The <tt>SharedLibVersion</tt> feature, where supported, uses selective symbol loading internally.</p>
        </div>
    </div>
</body>
</html>
